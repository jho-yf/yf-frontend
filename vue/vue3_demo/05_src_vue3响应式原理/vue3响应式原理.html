<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vue3响应式原理</title>
</head>
<body>
    <script>
        // 模拟vue2中响应式的实现
        let person = {
            name: '张三',
            age: 18
        }
        let p = {}
        Object.defineProperty(p, 'name', {
            get() {
                console.log('name get invoke')
                return person.name
            },
            set(newValue) {
                console.log('name set invoke, 在此处更新界面')
                person.name = newValue
            }
        })
        Object.defineProperty(p, 'age', {
            get() {
                console.log('age get invoke')
                return person.age
            },
            set(newValue) {
                console.log('age set invoke, 在此处更新界面')
                person.age = newValue
            }
        })
        p.name = '李四'
        console.log(p.name)

        p.age = 20
        console.log(p.age)


        person = {
            name: '张三',
            age: 18
        }

        console.log("模拟vue3响应式原理")
        // 模拟vue3中响应式的实现
        const proxy = new Proxy(person, {
            get(target, key) {
                console.log(`proxy的${key}被读取`)
                return Reflect.get(target, key)
            },
            set(target, key, newValue) {
                console.log(`proxy的${key}被修改，原来的值为:${target[key]},新的值为${newValue}`)
                target[key] = newValue
                return Reflect.set(target, key, newValue)
            },
            deleteProperty(target, key) {
                console.log(`proxy的${key}被删除`)
                return Reflect.deleteProperty(target, key)
            }
        })
        console.log(proxy)

        console.log(proxy.name)
        proxy.name = '李四'
        console.log(proxy.name)

        proxy.sex = '男'
        delete proxy.sex

        console.log(person)

        // 反射
        let obj = { a:1, b:2 }
        Reflect.defineProperty(obj, 'c', {
            get() {
                console.log('get invoke')
                return 3
            }
        })
        console.log(obj.c)

    </script>
    
</body>
</html>